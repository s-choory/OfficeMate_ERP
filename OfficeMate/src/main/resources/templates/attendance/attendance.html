<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OfficeMate</title>
    <link rel="stylesheet" href="css/attendence_styles.css">
    <script>
        function formatTime(timeString) {
			// 정규식으로 시간 부분만 추출
			const timeMatch = timeString.match(/(\d{2}):(\d{2}):(\d{2})/);
			if (timeMatch) {
			    const [_, hour, minute, second] = timeMatch;
			    return `${hour}시 ${minute}분 ${second}초`;
			}
			return '';
        }

		function calculateWorkHours(checkInTime, checkOutTime) {
		    // 시간 문자열을 시, 분, 초로 분리
		    const [checkInHour, checkInMinute, checkInSecond] = checkInTime.split(':').map(Number);
		    const [checkOutHour, checkOutMinute, checkOutSecond] = checkOutTime.split(':').map(Number);
		
		    // 출근 시간과 퇴근 시간을 밀리초로 변환
		    const checkInMilliseconds = checkInHour * 3600000 + checkInMinute * 60000 + checkInSecond * 1000;
		    const checkOutMilliseconds = checkOutHour * 3600000 + checkOutMinute * 60000 + checkOutSecond * 1000;
		
		    // 시간 차이 계산
		    const timeDiff = checkOutMilliseconds - checkInMilliseconds;
		
		    // 밀리초를 시간 단위로 변환하여 반환
		    return timeDiff / 3600000;
		}
		
		document.addEventListener("DOMContentLoaded", function() {
		    const attendanceRows = document.querySelectorAll('.attendance-row');
		
		    attendanceRows.forEach(row => {
		        const checkInElement = row.querySelector('.check-in');
		        const checkOutElement = row.querySelector('.check-out');
		        const statusElement = row.querySelector('.status');
		
		        const checkInTime = checkInElement.getAttribute('data-time');
		        const checkOutTime = checkOutElement.getAttribute('data-time');
		
		        console.log('Check-in time:', checkInTime);
		        console.log('Check-out time:', checkOutTime);
		
		        checkInElement.textContent = formatTime(checkInTime);
		        checkOutElement.textContent = formatTime(checkOutTime);
		
		        const workHours = calculateWorkHours(checkInTime, checkOutTime);
		        if (workHours >= 8) {
		            statusElement.textContent = "출근";
		        } else {
		            statusElement.textContent = "8시간 미만";
		        }
		    });
		});

		


    </script>
</head>

<body>
    <div class="sidebar">
        <a href="/home" style="text-decoration: none;">
            <div class="logo">OfficeMate</div>
        </a>
        <div class="padding"></div> <!-- 여백 추가 -->
        <ul class="menu">
            <li><a href="notice">공지사항</a></li>
            <li><a href="dept">부서</a></li>
            <li><a href="work">업무</a></li>
            <li><a href="attendance" style="background-color:#185066">출퇴근</a></li>
            <li><a href="document">문서</a></li>
            <li><a href="salary">급여지급</a></li>
            <div sec:authorize="hasRole('ADMIN')">
                <li><a href="admin/empManage">전체사원관리</a></li>
            </div>
        </ul>
    </div>

    <div class="login-container">
        <button class="login-button">로그인</button>
    </div>

    <div class="content">
        <h2>출퇴근 내역</h2>
        <br>

        <div sec:authorize="hasRole('ADMIN')">
            <button class="user_search"
                onclick="window.open('../docuent/user_search.html','blank', 'resizealbe=yes scrollbars=no width=790 height=450 left=100 top=200')">검색</button>
        </div>
        <table>
            <tr>
                <th style="width:20%">일자</th>
                <th style="width:30%">출근 시각</th>
                <th style="width:30%">퇴근 시각</th>
                <th style="width:20%">상태</th>
            </tr>
            <tr class="attendence attendance-row" th:each="attendance : ${attendanceList}">
                <td><span th:text="${attendance.date}"></span></td>
                <td class="check-in" th:data-time="${attendance.checkIn}"></td>
                <td class="check-out" th:data-time="${attendance.checkOut}"></td>
				<td class="status"></td>	
            </tr>
        </table>
    </div>
</body>

</html>
